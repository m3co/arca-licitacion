<!doctype html>
<html>
  <head>
    <script src="node_modules/socket.io-client/dist/socket.io.js"></script>
    <script src="node_modules/d3/build/d3.min.js"></script>
    <script src="https://rawgit.com/rianby64/html-toJSON-example/master/toJSON.js"></script>
    <script src="https://rawgit.com/m3co/arca-utiles/master/utils.js"></script>
    <link href="tree/tree.css" rel="stylesheet" />
    <style>
      body {
        font-family: "sans-serif";
        font-size: 10px;
      }
    </style>
  </head>
  <body>
    <select id="ContractorId">
    </select>
    <script>
'use strict';
(() => {
var ContractorId = window.location.search.match(/\?ContractorId=(\d+)$/);
document.querySelector('select#ContractorId').value = ContractorId ? ContractorId[1] : 1;

document.querySelector('select#ContractorId').addEventListener('change', e => {
  window.location.search = `ContractorId=${e.target.value}`;
});

var contractors = [];
var lastSTO;
function doselect(row) {
  var found = contractors.find(d => d.id == row.id);
  if (!found) {
    contractors.push(row);
  }
  if (lastSTO) {
    clearTimeout(lastSTO);
  }

  lastSTO = setTimeout(() => {
    render();
  });
}

function render() {
  d3.select('#ContractorId')
    .selectAll('option')
    .data(contractors)
    .enter()
    .append('option').attr('value', d => d.id).attr('label', d => d.fullname);

  d3.select(`#ContractorId option[value="${
    location.search.match(/\d+$/).toString()}"]`).attr('selected', '');
}

window.contractor = {
  doselect: doselect
};

})();
    </script>
    <script src="client.js"></script>
    <div style="display: table; width:100%;">
      <ol class="tree" style="display: table-cell; width: 30%;"></ol>
      <table id="fnpreAPU" style="display: table; width: 70%;"
        table="fnpreAPU">
        <caption>fnpreAPU</caption>
        <thead><tr></tr></thead>
        <tbody></tbody>
      </table>
      <script src="viewpreapu.js"></script>
      <script src="tree/tree.js"></script>
    </div>
  </body>
</html>
